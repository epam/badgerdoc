name: pipelines linters and tests

on:
  push:
    paths:
      - pipelines/**
      - .github/worlflows/pipelines.yml
  pull_request:
    paths:
      - pipelines/**
      - .github/worlflows/pipelines.yml
jobs:
   pipelines-linters-and-tests:
     runs-on: ubuntu-latest
     strategy:
       matrix:
         python-version: [ "3.8.15" ]
     steps:
       - uses: actions/checkout@v4
       - uses: actions/setup-python@v4
         with:
           python-version: ${{ matrix.python-version }}
       - name: Install dependencies
         working-directory: ./pipelines
         run: |
           python -m pip install --upgrade pip
           pip install poetry>=1.1.13
           poetry install --no-root
           poetry add ../lib/filter_lib
           poetry add ../lib/tenants
       - name: Run linters and checkers [flake8 -> isort -> black]
         working-directory: ./pipelines
         run: |
           poetry run flake8 --extend-ignore=E203 pipelines/
           poetry run isort --profile=black --line-length=79 --check-only pipelines/
           poetry run black --check --line-length=79 pipelines/
       - name: Run tests
         working-directory: ./pipelines
         run: |
           poetry run pytest tests/
